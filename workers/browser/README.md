# Browser Worker

Playwright-backed worker for comprehensive browser automation. Supports navigation, interaction, data extraction, and document generation. Emits RunEvents to the control plane and serves artifacts (screenshots, PDFs) over HTTP.

## Available Tools

### `browser.navigate`
Load a URL in the browser.

```json
{
  "url": "https://example.com",
  "waitUntil": "networkidle"
}
```

### `browser.snapshot`
Capture a screenshot of the current page.

```json
{
  "fullPage": true,
  "selector": "#content"  // Optional: capture specific element
}
```

### `browser.click`
Click an element by CSS selector.

```json
{
  "selector": "button.submit",
  "waitForNavigation": true
}
```

### `browser.type`
Type text into an input field.

```json
{
  "selector": "input[name='search']",
  "text": "search query",
  "clear": true,  // Clear field before typing
  "delay": 50     // Milliseconds between keystrokes
}
```

### `browser.scroll`
Scroll the page.

```json
{
  "direction": "down",  // or "up", "top", "bottom"
  "amount": 500         // Pixels to scroll (not used for top/bottom)
}
```

### `browser.extract`
Extract data from page elements.

```json
{
  "selector": ".product-item",
  "attribute": "textContent",  // or "href", "src", "innerHTML", etc.
  "multiple": true             // Return array of all matches
}
```

### `browser.evaluate`
Execute JavaScript in the page context.

```json
{
  "script": "return document.querySelectorAll('a').length;",
  "args": []  // Optional arguments to pass to script
}
```

### `browser.pdf`
Generate a PDF from the current page.

```json
{
  "filename": "report.pdf",
  "format": "A4",      // or "Letter", "Legal", etc.
  "printBackground": true
}
```

## Endpoints

### POST /tools/execute
Handles all browser tool invocations.

Request:
```json
{
  "run_id": "uuid",
  "invocation_id": "uuid",
  "tool_name": "browser.navigate",
  "input": { "url": "https://example.com" },
  "timeout_ms": 60000
}
```

### POST /cancel
```json
{ "run_id": "uuid" }
```

### GET /artifacts/*
Serves screenshot files generated by Playwright.

## Environment

- `BROWSER_WORKER_PORT` (default `8082`)
- `CONTROL_PLANE_URL` (default `http://localhost:8080`)
- `BROWSER_WORKER_URL` (default `http://localhost:8082`)
- `BROWSER_HEADLESS` (default `true`)

## Allowlist

Tools must be explicitly allowlisted via the `ALLOWED_TOOLS` environment variable:

```bash
ALLOWED_TOOLS=browser.navigate,browser.snapshot,browser.click,browser.type,browser.scroll,browser.extract,browser.evaluate,browser.pdf
```

## Run

```sh
npm install
npm run dev
```
